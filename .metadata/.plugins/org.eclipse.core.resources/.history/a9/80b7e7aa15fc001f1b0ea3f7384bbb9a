<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page import="java.sql.*" %>
<%@ page import="javax.servlet.http.HttpSession" %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="StyleSheets/style.css">
</head>
<body>
    <%
        HttpSession sessionUser = request.getSession(false);
        if (sessionUser == null || sessionUser.getAttribute("user") == null) {
            response.sendRedirect("index.html");
            return;
        }
        String userEmail = (String) sessionUser.getAttribute("user");
        String userName = "";
        String userMobile = "";
        
        Connection con = null;
        PreparedStatement ps = null;
        ResultSet rs = null;
        
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            con = DriverManager.getConnection("jdbc:mysql://localhost:3306/hotel_booking", "root", "Tejas@412301");
            
            String query = "SELECT username, mobile FROM users WHERE email=?";
            ps = con.prepareStatement(query);
            ps.setString(1, userEmail);
            rs = ps.executeQuery();
            
            if (rs.next()) {
                userName = rs.getString("username");
                userMobile = rs.getString("mobile");
                sessionUser.setAttribute("username", userName);
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try { if (rs != null) rs.close(); } catch (Exception e) {}
            try { if (ps != null) ps.close(); } catch (Exception e) {}
            try { if (con != null) con.close(); } catch (Exception e) {}
        }
    %>
     <header>
        <nav>
            <div class="logo">HotelBooking
            </div>
            
        <a href="#contact">Contact</a>
		<a href="SignUp.jsp">SignUp</a>
        <a href="login.jsp">login</a>
             
        </nav>
    </header>
    <h1>Welcome, <%= userName %>!</h1>
    <%-- <p>Email: <%= userEmail %></p> --%>
   <%--  <p>Mobile: <%= userMobile %></p> --%>
    
    <div class="cards-container">
        <div class="card">
            <h2>Book a Hotel</h2>
            <p>Find the best hotels at the best prices.</p>
            <a href="#">Book Now</a>
        </div>
        <div class="card">
            <h2>Available Rooms</h2>
            <p>Check out the available rooms in various hotels.</p>
            <a href="#">View Rooms</a>
        </div>
        <div class="card">
            <h2>Exclusive Deals</h2>
            <p>Get discounts and special offers on hotel bookings.</p>
            <a href="#">Check Deals</a>
        </div>
    </div>
    
    <a href="logoutServlet">Logout</a>
</body>
</html>